$scoreboard players set @s defense.towers $(cooldown)
$execute at @s positioned ~ -59 ~ unless entity @e[distance=..$(range),tag=defense-monster] run return 0
scoreboard players set $max defense.distance -2147483648
$execute at @s positioned ~ -59 ~ as @e[tag=defense-monster,distance=..$(range)] run scoreboard players operation $max defense.distance > @s defense.distance
$execute at @s positioned ~ -59 ~ as @e[tag=defense-monster,distance=..$(range)] if score @s defense.distance = $max defense.distance run tag @s add defense-target
execute as @n[tag=defense-monster,tag=defense-target] at @s positioned ^ ^ ^3 align xyz run summon block_display ~ ~ ~ {Passengers:[{id:"marker",Tags:["defense.tree_marker"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_log",Properties:{axis:"y"}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,4.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_log",Properties:{axis:"y"}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_log",Properties:{axis:"y"}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,1.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,-1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,-2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_log",Properties:{axis:"y"}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-2.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-2.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,-1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-2.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-2.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-2.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,-2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-1.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-1.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,-1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-1.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-1.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-1.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,-2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.9375f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.9375f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,-1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.9375f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.9375f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.9375f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,-2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_log",Properties:{axis:"y"}},transformation:[1.0000f,0.0000f,0.0000f,-0.0000f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-2.0000f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-2.0000f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,-1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-2.0000f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-2.0000f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-2.0000f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,-2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-1.0000f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-1.0000f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,-1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-1.0000f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-1.0000f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-1.0000f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,-2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.9375f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.9375f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,-1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.9375f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.9375f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.9375f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,-2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-0.0000f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,2.0000f,0.0000f,0.0000f,1.0000f,-2.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,-1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,3.0000f,0.0000f,0.0000f,1.0000f,1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,4.0000f,0.0000f,0.0000f,1.0000f,1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,1.0000f,0.0000f,1.0000f,0.0000f,4.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,4.0000f,0.0000f,0.0000f,1.0000f,-1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-1.0000f,0.0000f,1.0000f,0.0000f,4.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,5.0000f,0.0000f,0.0000f,1.0000f,1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,1.0000f,0.0000f,1.0000f,0.0000f,5.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,5.0000f,0.0000f,0.0000f,1.0000f,-1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-1.0000f,0.0000f,1.0000f,0.0000f,5.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f,0.0000f,5.0000f,0.0000f,0.0000f,1.0000f,0.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,-1.0000f,0.0000f,1.0000f,0.0000f,4.0000f,0.0000f,0.0000f,1.0000f,-1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,1.0000f,0.0000f,1.0000f,0.0000f,4.0000f,0.0000f,0.0000f,1.0000f,-1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]},{id:"minecraft:block_display",block_state:{Name:"minecraft:oak_leaves",Properties:{}},transformation:[1.0000f,0.0000f,0.0000f,1.0000f,0.0000f,1.0000f,0.0000f,4.0000f,0.0000f,0.0000f,1.0000f,1.0000f,0.0000f,0.0000f,0.0000f,1.0000f],Tags:["defense.tree"]}],Tags:["defense.tree"]}
execute as @e[tag=defense.tree] at @s run function core:defense/towers/tree/trees/rotate_facing
execute as @e[tag=defense.tree_marker] at @s run function core:defense/towers/tree/trees/rotate_facing

execute as @e[tag=defense.tree] run data modify entity @s teleport_duration set value 20
execute as @e[tag=defense.tree] at @s run function core:defense/towers/tree/trees/move_down